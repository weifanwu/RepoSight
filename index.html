<head>
    <style> body { margin: 0; } </style>
  
    <script src="//unpkg.com/d3-dsv"></script>
    <script src="//unpkg.com/dat.gui"></script>
    <script src="//unpkg.com/d3-octree"></script>
    <script src="//unpkg.com/d3-force-3d"></script>
  
    <script src="//unpkg.com/3d-force-graph"></script>
    <!--<script src="../../dist/3d-force-graph.js"></script>-->
  </head>
  
  <body>
    <div id="graph"></div>
  
    <script>
      // controls
      const controls = { 'DAG Orientation': 'td'};
      const gui = new dat.GUI();
      gui.add(controls, 'DAG Orientation', ['td', 'bu', 'lr', 'rl', 'zout', 'zin', 'radialout', 'radialin', null])
        .onChange(orientation => graph && graph.dagMode(orientation));
  
      // graph config
      const NODE_REL_SIZE = 3;
      const graph = new ForceGraph3D(document.getElementById('graph'))
        .dagMode('td')
        .dagLevelDistance(200)
        .backgroundColor('white')
        .linkColor(() => 'black')
        .nodeRelSize(NODE_REL_SIZE)
        .nodeId('path')
        .nodeVal('size')
        .nodeLabel('path')
        .nodeAutoColorBy('module')
        .nodeOpacity(0.9)
        .linkDirectionalParticles(2)
        .linkDirectionalParticleWidth(0.8)
        .linkDirectionalParticleSpeed(0.006)
        .d3Force('collision', d3.forceCollide(node => Math.cbrt(node.size) * NODE_REL_SIZE))
        .d3VelocityDecay(0.3);
  
      // Decrease repel intensity
      graph.d3Force('charge').strength(-15);
  
      fetch('../data.csv')
        .then(r => r.text())
        .then(d3.csvParse)
        .then(data => {
          
          const nodes = [], links = [];
          data.forEach(({ path }) => {
            const levels = path.split('/'),
              level = levels.length - 1,
              module = level > 0 ? levels[1] : null,
              leaf = levels.pop(),
              parent = levels.join('/');

            const node = {
              path,
              leaf,
              module,
              size: 20,
              level
            };
  
            nodes.push(node);
  
            if (parent) {
              links.push({source: parent, target: path, targetNode: node});
            }
          });

          graph.graphData({ nodes, links });
          graph.onNodeHover(node => {
          document.querySelectorAll('.force-graph-label').forEach(el => {
            if (node && el.innerHTML === node.path) {
              el.style.color = 'black'; // Change to red on hover
            } else {
              el.style.color = 'black'; // Default color
            }
          });
        });
        });
    </script>
  </body>